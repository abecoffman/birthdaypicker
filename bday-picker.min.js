!function(e){var a={short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],long:["January","February","March","April","May","June","July","August","September","October","November","December"]},t=new Date,n=t.getFullYear();t.getMonth(),t.getDate();e.fn.birthdaypicker=function(t){var r={maxAge:120,minAge:0,futureDates:!1,maxYear:n,dateFormat:"middleEndian",monthFormat:"short",placeholder:!0,legend:"",defaultDate:!1,fieldName:"birthdate",fieldId:"birthdate",hiddenDate:!0,onChange:null,tabindex:null,selectClass:"birthdate-select",l18n:{short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],long:["January","February","March","April","May","June","July","August","September","October","November","December"],year:"Year:",day:"Day:",month:"Month:"}};return this.each(function(){t&&e.extend(r,t);var l=e("<fieldset class='birthday-picker'></fieldset>"),d=e("<select class='birth-year' name='birth[year]'></select>").addClass(r.selectClass),o=e("<select class='birth-month' name='birth[month]'></select>").addClass(r.selectClass),i=e("<select class='birth-day' name='birth[day]'></select>").addClass(r.selectClass);r.legend&&e("<legend>"+r.legend+"</legend>").appendTo(l);var p=r.tabindex;"bigEndian"==r.dateFormat?(l.append(d).append(o).append(i),null!=p&&(d.attr("tabindex",p),o.attr("tabindex",p++),i.attr("tabindex",p++))):"littleEndian"==r.dateFormat?(l.append(i).append(o).append(d),null!=p&&(i.attr("tabindex",p),o.attr("tabindex",p++),d.attr("tabindex",p++))):(l.append(o).append(i).append(d),null!=p&&(o.attr("tabindex",p),i.attr("tabindex",p++),d.attr("tabindex",p++))),r.placeholder&&(e("<option value='0'>"+r.l18n.year+"</option>").appendTo(d),e("<option value='0'>"+r.l18n.month+"</option>").appendTo(o),e("<option value='0'>"+r.l18n.day+"</option>").appendTo(i));var s;if(r.defaultDate){var u=new Date(r.defaultDate+"T00:00:00"),h=u.getFullYear(),c=u.getMonth()+1,f=u.getDate();c<10&&(c="0"+c),f<10&&(f="0"+f),s=h+"-"+c+"-"+f}r.hiddenDate&&e("<input type='hidden' name='"+r.fieldName+"'/>").attr("id",r.fieldId).val(s).appendTo(l);var m=n-r.minAge,v=n-r.maxAge;r.futureDates&&r.maxYear!=n&&(m=r.maxYear>1e3?r.maxYear:n+r.maxYear);for(var b=m;b>=v;b--)e("<option></option>").attr("value",b).text(b).appendTo(d);for(var g=0;g<12;g++)e("<option></option>").attr("value",g+1).text(r.l18n[r.monthFormat][g]).appendTo(o);for(var D=1;D<32;D++)e("<option></option>").attr("value",D).text(D).appendTo(i);if(e(this).append(l),r.defaultDate){var y=new Date(r.defaultDate+"T00:00:00");d.val(y.getFullYear()),o.val(y.getMonth()+1),i.val(y.getDate())}l.change(function(){var t=new Date,n=(t.getFullYear(),t.getMonth()+1),l=t.getDate(),p=parseInt(d.val(),10),u=parseInt(o.val(),10),h=parseInt(i.val(),10),c=new Date(p,u,0).getDate(),f=parseInt(o.children(":last").val()),v=parseInt(i.children(":last").val());if(v>c)for(;v>c;)i.children(":last").remove(),v--;else if(v<c)for(;v<c;)v++,i.append("<option value="+v+">"+v+"</option>");if(!r.futureDates&&p==m){if(f>n){for(;f>n;)o.children(":last").remove(),f--;i.children(":first").attr("selected","selected")}if(u===n)for(;v>l;)i.children(":last").remove(),v-=1}if(p!=m&&12!=f)for(;f<12;)o.append("<option value="+(f+1)+">"+a[r.monthFormat][f]+"</option>"),f++;p*u*h!=0&&(u<10&&(u="0"+u),h<10&&(h="0"+h),s=p+"-"+u+"-"+h,e(this).find("#"+r.fieldId).val(s),null!=r.onChange&&r.onChange(s))})})}}(jQuery);